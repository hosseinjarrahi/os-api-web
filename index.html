<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const HOST = "localhost"; // Destination IP address
      const PORT = 8765; // Destination port

      const socket = new WebSocket(`ws://${HOST}:${PORT}`);

      socket.onopen = function () {
        console.log("Connected to server");

        let data = {
          cmd: 10,
          amount: 12000,
          sign: "899|123456789",
          swipe: true,
        };

        let str = JSON.stringify(data);

        str = "00" + str.length + str;

        // Send the data to the server
        socket.send(str);
      };

      socket.onmessage = function (event) {
        console.log("Message received: " + event.data);
        const responseString = event.data;

        // Remove the prefix part "Received response from server: 0161" from the string
        const jsonString = responseString.substring(
          responseString.indexOf("{")
        );
        const jsonObject = JSON.parse(jsonString);

        console.log(jsonObject);

        socket.close();
      };

      socket.onerror = function (error) {
        console.error("Socket error: " + error.message);
      };

      socket.onclose = function (event) {
        if (event.wasClean) {
          console.log("Connection closed cleanly");
        } else {
          console.log("Connection unexpectedly closed");
        }
      };
    </script>
  </body>
</html>
